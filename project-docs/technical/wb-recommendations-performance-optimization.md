# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ WB —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ Wildberries

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ò—Å—Ö–æ–¥–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:
- **920 —Ç–æ–≤–∞—Ä–æ–≤ √ó 3-5 —Å–µ–∫—É–Ω–¥ = 46-77 –º–∏–Ω—É—Ç** –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## ‚ö° –†–µ—à–µ–Ω–∏–µ: –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### **1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
–í–º–µ—Å—Ç–æ 920 –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 4-5 –±–æ–ª—å—à–∏—Ö –ø–∞–∫–µ—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
# –ë—ã–ª–æ (920 –∑–∞–ø—Ä–æ—Å–æ–≤):
for wb_sku in wb_skus:
    wb_data = get_wb_product_data(wb_sku)  # SQL –∑–∞–ø—Ä–æ—Å
    punta_data = get_punta_data(wb_sku)    # SQL –∑–∞–ø—Ä–æ—Å
    oz_links = get_oz_links(wb_sku)        # SQL –∑–∞–ø—Ä–æ—Å

# –°—Ç–∞–ª–æ (4 –∑–∞–ø—Ä–æ—Å–∞):
wb_data_all = preload_wb_data(wb_skus)           # 1 SQL –∑–∞–ø—Ä–æ—Å
punta_data_all = preload_punta_data(wb_skus)     # 1 SQL –∑–∞–ø—Ä–æ—Å  
oz_links_all = preload_oz_links(wb_skus)         # 1 SQL –∑–∞–ø—Ä–æ—Å
oz_chars_all = preload_oz_characteristics(...)   # 1 SQL –∑–∞–ø—Ä–æ—Å
```

#### **2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º**
–¢–æ–≤–∞—Ä—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –≥—Ä—É–ø–ø–∞:

```python
# –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø+–ø–æ–ª+–±—Ä–µ–Ω–¥
groups = {
    "–°–∞–±–æ|–ñ–µ–Ω—Å–∫–∏–π|Nike": [—Ç–æ–≤–∞—Ä1, —Ç–æ–≤–∞—Ä2, —Ç–æ–≤–∞—Ä3],
    "–ö—Ä–æ—Å—Å–æ–≤–∫–∏|–ú—É–∂—Å–∫–æ–π|Adidas": [—Ç–æ–≤–∞—Ä4, —Ç–æ–≤–∞—Ä5],
    # ...
}

# –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –Ω–∞—Ö–æ–¥–∏–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –æ–¥–∏–Ω —Ä–∞–∑
for group_name, products in groups.items():
    candidates = find_candidates_for_group(group_name)  # 1 —Ä–∞–∑ –Ω–∞ –≥—Ä—É–ø–ø—É
    for product in products:
        recommendations = score_candidates(product, candidates)
```

#### **3. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π**
- –û–±—â–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–≤—è–∑–µ–π

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|----------------|-------------------|------------|
| **920 —Ç–æ–≤–∞—Ä–æ–≤** | 46-77 –º–∏–Ω—É—Ç | 5-10 –º–∏–Ω—É—Ç | **5-15x –±—ã—Å—Ç—Ä–µ–µ** |
| **SQL –∑–∞–ø—Ä–æ—Å–æ–≤** | ~2760 | ~10 | **276x –º–µ–Ω—å—à–µ** |
| **–í—Ä–µ–º—è –Ω–∞ —Ç–æ–≤–∞—Ä** | 3-5 —Å–µ–∫—É–Ω–¥ | 0.3-0.7 —Å–µ–∫—É–Ω–¥ | **8-10x –±—ã—Å—Ç—Ä–µ–µ** |
| **–ü–∞–º—è—Ç—å** | –õ–∏–Ω–µ–π–Ω–∞—è | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ |

## üìä –≠—Ç–∞–ø—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 1: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (30% –≤—Ä–µ–º–µ–Ω–∏)
```sql
-- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö WB –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
SELECT wb.wb_sku, wb.wb_brand, wp.wb_fbo_stock, ...
FROM wb_products wb 
LEFT JOIN wb_prices wp ON wb.wb_sku = wp.wb_sku
WHERE wb.wb_sku IN (—Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö SKU)
```

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π WB‚ÜîOZ (20% –≤—Ä–µ–º–µ–Ω–∏)
```python
# –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π —á–µ—Ä–µ–∑ —à—Ç—Ä–∏—Ö–∫–æ–¥—ã
wb_to_oz_links = linker.link_wb_to_oz(all_wb_skus)
```

### –≠—Ç–∞–ø 3: –û–±–æ–≥–∞—â–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ (20% –≤—Ä–µ–º–µ–Ω–∏)
```python
# –°–æ–∑–¥–∞–Ω–∏–µ –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å—Ä–∞–∑—É
enriched_products = create_enriched_products_batch(
    wb_skus, wb_data_cache, punta_cache, wb_to_oz_links, ozon_chars_cache
)
```

### –≠—Ç–∞–ø 4: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ (30% –≤—Ä–µ–º–µ–Ω–∏)
```python
# –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º
product_groups = group_products_by_criteria(enriched_products)
for group_key, products in product_groups.items():
    candidates = find_group_candidates(group_key, enriched_products)
    for product in products:
        result = process_single_with_candidates(product, candidates)
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

#### `process_batch_optimized()`
```python
def process_batch_optimized(self, wb_skus: List[str], progress_callback: Optional[Callable] = None) -> WBBatchResult:
    """
    üöÄ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ WB —Ç–æ–≤–∞—Ä–æ–≤
    
    –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
    1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
    2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
    3. –ü–∞–∫–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
    4. –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
    """
```

#### `_preload_wb_data()`
```python
def _preload_wb_data(self, wb_skus: List[str]) -> Dict[str, Dict[str, Any]]:
    """–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö WB –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º"""
    placeholders = ','.join(['?' for _ in wb_skus])
    query = f"SELECT ... FROM wb_products wb ... WHERE wb.wb_sku IN ({placeholders})"
```

#### `_group_products_by_criteria()`
```python
def _group_products_by_criteria(self, enriched_products: Dict[str, WBProductInfo]) -> Dict[str, List[WBProductInfo]]:
    """–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞"""
    # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø+–ø–æ–ª+–±—Ä–µ–Ω–¥
    group_key = f"{product.get_effective_type()}|{product.get_effective_gender()}|{product.get_effective_brand()}"
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–∫–µ—Ç–∞:

```python
if len(wb_skus) >= 50:
    # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤
    batch_result = processor.process_batch_optimized(wb_skus, progress_callback)
else:
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –º–∞–ª—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
    batch_result = processor.process_batch(wb_skus, progress_callback)
```

**–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- **< 50 —Ç–æ–≤–∞—Ä–æ–≤**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (–Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–µ –æ–∫—É–ø–∞—é—Ç—Å—è)
- **‚â• 50 —Ç–æ–≤–∞—Ä–æ–≤**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ)

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

| –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|---------------|---------------------|------------------|-----------|
| **50 —Ç–æ–≤–∞—Ä–æ–≤** | 2.5 –º–∏–Ω—É—Ç—ã | 45 —Å–µ–∫—É–Ω–¥ | **3.3x** |
| **100 —Ç–æ–≤–∞—Ä–æ–≤** | 5 –º–∏–Ω—É—Ç | 1.5 –º–∏–Ω—É—Ç—ã | **3.3x** |
| **200 —Ç–æ–≤–∞—Ä–æ–≤** | 10 –º–∏–Ω—É—Ç | 2.5 –º–∏–Ω—É—Ç—ã | **4x** |
| **500 —Ç–æ–≤–∞—Ä–æ–≤** | 25 –º–∏–Ω—É—Ç | 4 –º–∏–Ω—É—Ç—ã | **6.3x** |
| **920 —Ç–æ–≤–∞—Ä–æ–≤** | 46 –º–∏–Ω—É—Ç | 6 –º–∏–Ω—É—Ç | **7.7x** |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- CPU: 15-20% (–æ–∂–∏–¥–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤)
- Memory: 200-500 MB
- Database connections: –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- CPU: 60-80% (–∞–∫—Ç–∏–≤–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è)
- Memory: 300-800 MB (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
- Database connections: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ë–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç—ã
- **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏**: 40+ –º–∏–Ω—É—Ç ‚Üí 6 –º–∏–Ω—É—Ç
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —Ç–æ–≤–∞—Ä–æ–≤
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞
- **UX**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î**: –≤ 200+ —Ä–∞–∑ –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–õ—É—á—à–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**: CPU —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —ç—Ç–∞–ø–∞–º

## üîÆ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### **1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
```python
import concurrent.futures

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–ø–ø —Ç–æ–≤–∞—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
with concurrent.futures.ThreadPoolExecutor(max_workers=4) as executor:
    futures = []
    for group_key, products in product_groups.items():
        future = executor.submit(process_product_group, group_key, products)
        futures.append(future)
```

#### **2. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
```python
# –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
@lru_cache(maxsize=1000)
def get_cached_recommendations(wb_sku: str, config_hash: str):
    # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–æ–≤–∞—Ä–∞ + –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

#### **3. –ò–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
```sql
-- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
CREATE INDEX idx_wb_products_type_gender_brand ON wb_products(enriched_type, enriched_gender, enriched_brand);
CREATE INDEX idx_wb_products_stock ON wb_products(wb_fbo_stock) WHERE wb_fbo_stock > 0;
```

#### **4. Streaming –æ–±—Ä–∞–±–æ—Ç–∫–∞**
```python
# –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ (1000+ —Ç–æ–≤–∞—Ä–æ–≤)
async def process_batch_streaming(wb_skus: List[str]):
    async for batch in chunk_list(wb_skus, chunk_size=100):
        yield await process_chunk_optimized(batch)
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä**: —Ü–µ–ª—å < 1 —Å–µ–∫—É–Ω–¥–∞
- **–£—Ç–∏–ª–∏–∑–∞—Ü–∏—è SQL –ø—É–ª–∞**: —Ü–µ–ª—å < 50%
- **Memory footprint**: —Ü–µ–ª—å < 1GB
- **Success rate**: —Ü–µ–ª—å > 95%

### –ê–ª–µ—Ä—Ç—ã
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–∫–µ—Ç–∞ > 15 –º–∏–Ω—É—Ç
- Memory usage > 2GB
- SQL connection pool exhausted
- Error rate > 10%

---

## üìù –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

**–ê–≤—Ç–æ—Ä**: WB Recommendations Team  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2024-12-19  
**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–°—Ç–∞—Ç—É—Å**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã**:
- [WB Recommendations Implementation](wb-recommendations-implementation.md)
- [Database Utils API](api/database-utils.md)
- [Performance Testing Results](../testing/wb-recommendations-performance.md)

*–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–∑–≤–æ–ª–∏–ª–∞ —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –≤ 5-15 —Ä–∞–∑.* 
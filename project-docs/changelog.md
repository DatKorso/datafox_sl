# Changelog

## 2025-01-11 - Исправление типа данных wb_sku в punta_table

### Проблема
При тестировании было обнаружено, что `wb_sku` в таблице `punta_table` имел тип VARCHAR, в то время как во всех других таблицах он имеет числовой тип (INTEGER/BIGINT). Это вызывало проблемы при соединении таблиц в SQL запросах.

### Решение
1. **Обновлена схема**: В `utils/db_schema.py` изменен тип `wb_sku` с VARCHAR на INTEGER для таблицы `punta_table`
2. **Добавлена обработка конверсии**: Добавлен notes `convert_to_integer` для автоматической конвертации строковых wb_sku в числа при импорте
3. **Миграция данных**: Выполнена миграция существующей таблицы с конвертацией данных
4. **Обновлены функции**: Функция `get_punta_data()` обновлена для корректной работы с числовыми wb_sku

### Результат
- Из 9332 записей успешно конвертировано 8553 (779 записей с невалидными wb_sku исключены)
- Все JOIN операции между таблицами теперь работают корректно
- PUNTA_ колонки в аналитических отчетах работают правильно
- Типы данных wb_sku стандартизированы во всех таблицах

### Техническая информация
- **Измененные файлы**: `utils/db_schema.py`, `utils/db_crud.py`, `utils/analytic_report_helpers.py`
- **Обновленная документация**: `project-docs/analytic-report-generation.md`, `project-docs/tech-specs.md`
- **Тестирование**: Проверено на тестовом файле `test_analytic_report_with_punta.xlsx` 